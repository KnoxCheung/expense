<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Weekly Expense Tracker</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
        />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
        />
        <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
        <style>
            body {
                font-family: Arial, sans-serif;
                line-height: 1.6;
                margin: 0;
                padding: 20px;
                background-color: #f0f0f0;
            }
            .container {
                display: flex;
                flex-wrap: wrap;
                width: 100%;
            }
            .left-panel,
            .right-panel {
                flex: 1;
                min-width: 300px;
                padding: 20px;
                background-color: white;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
                border-radius: 10px;
                margin: 10px;
            }
            h2 {
                margin-top: 0;
                color: #333;
            }
            form {
                margin-bottom: 20px;
            }
            input,
            select,
            button {
                display: block;
                width: 100%;
                margin-bottom: 10px;
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: 5px;
            }
            button {
                background-color: #4caf50;
                color: white;
                border: none;
                cursor: pointer;
                transition: background-color 0.3s;
            }
            button:hover {
                background-color: #45a049;
            }
            #expenseList {
                max-height: 300px;
                overflow-y: auto;
            }
            #budgetStatus,
            #weeklyReminder {
                margin-top: 20px;
            }
            #pieChartContainer {
                width: 300px;
                height: 300px;
                margin: 0 auto;
            }
            .expense-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 10px;
                padding: 10px;
                background-color: #f9f9f9;
                border-radius: 5px;
                transition: background-color 0.3s;
            }
            .expense-item:hover {
                background-color: #f0f0f0;
            }
            .expense-item button {
                width: auto;
                padding: 5px 10px;
                margin-left: 5px;
            }
            #clearAllData {
                background-color: #f44336;
                margin-top: 20px;
            }
            .budget-status-item {
                padding: 10px;
                margin-bottom: 5px;
                border-radius: 5px;
                transition: all 0.3s;
            }
            .budget-status-good {
                background-color: #dff0d8;
                color: #3c763d;
                border-left: 5px solid #3c763d;
            }
            .budget-status-normal {
                background-color: #fcf8e3;
                color: #8a6d3b;
                border-left: 5px solid #8a6d3b;
            }
            .budget-status-over {
                background-color: #f2dede;
                color: #a94442;
                border-left: 5px solid #a94442;
            }
            .category-icons {
                display: flex;
                justify-content: space-around;
                margin-bottom: 20px;
            }
            .category-icon {
                font-size: 24px;
                cursor: pointer;
                transition: color 0.3s;
            }
            .category-icon:hover {
                color: #4caf50;
            }
            .category-icon.active {
                color: #4caf50;
            }
            .week-block {
                margin-bottom: 20px;
                padding: 10px;
                background-color: #f0f0f0;
                border-radius: 5px;
            }
            .week-block h3 {
                margin-top: 0;
                color: #333;
            }
            .flatpickr-calendar {
                display: inline-block !important;
            }
            .budget-status-block {
                margin-bottom: 20px;
                padding: 10px;
                background-color: #f0f0f0;
                border-radius: 5px;
                display: flex;
                flex-wrap: wrap;
                justify-content: space-between;
            }
            .budget-status-block h3 {
                width: 100%;
                margin-top: 0;
                margin-bottom: 10px;
                color: #333;
            }
            .budget-status-item {
                flex: 1;
                min-width: 150px;
                margin-right: 10px;
                margin-bottom: 10px;
            }
            /* Add space between calendar and Amount input */
            #date {
                margin-bottom: 10px;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="left-panel">
                <h2>Add/Edit Expense</h2>
                <div class="category-icons">
                    <i
                        class="fas fa-utensils category-icon"
                        data-category="indoorCooking"
                        title="Indoor Cooking"
                    ></i>
                    <i
                        class="fas fa-hamburger category-icon"
                        data-category="outdoorDinners"
                        title="Outdoor Dinners"
                    ></i>
                    <i
                        class="fas fa-bus category-icon"
                        data-category="transportFees"
                        title="Transport Fees"
                    ></i>
                    <i
                        class="fas fa-film category-icon"
                        data-category="entertainment"
                        title="Entertainment"
                    ></i>
                    <i
                        class="fas fa-graduation-cap category-icon"
                        data-category="education"
                        title="Education"
                    ></i>
                    <i
                        class="fas fa-shopping-cart category-icon"
                        data-category="shopping"
                        title="Shopping"
                    ></i>
                    <i
                        class="fas fa-hospital category-icon"
                        data-category="medicalFees"
                        title="Medical Fees"
                    ></i>
                </div>
                <form id="expenseForm">
                    <input type="hidden" id="editIndex" value="" />
                    <select id="category" required>
                        <option value="">Select Category</option>
                        <option value="indoorCooking">Indoor Cooking</option>
                        <option value="outdoorDinners">Outdoor Dinners</option>
                        <option value="transportFees">Transport Fees</option>
                        <option value="entertainment">Entertainment</option>
                        <option value="education">Education</option>
                        <option value="shopping">Shopping</option>
                        <option value="medicalFees">Medical Fees</option>
                    </select>
                    <input
                        type="text"
                        id="date"
                        required
                        placeholder="Select Date"
                    />
                    <input
                        type="number"
                        id="amount"
                        placeholder="Amount"
                        required
                    />
                    <button type="submit" id="submitBtn">Add Expense</button>
                </form>
                <h2>Expense List</h2>
                <div id="expenseList"></div>
                <button id="clearAllData">Clear All Data</button>
            </div>
            <div class="right-panel">
                <h2>Expense Summary</h2>
                <div id="pieChartContainer">
                    <canvas id="pieChart"></canvas>
                </div>
                <h2>Budget Status</h2>
                <div id="budgetStatus"></div>
                <h2>Weekly Reminder</h2>
                <div id="weeklyReminder"></div>
            </div>
        </div>

        <script>
            const EXPENSE_CATEGORIES = [
                {
                    name: "Indoor Cooking",
                    key: "indoorCooking",
                    budget: { good: 12500, normal: 15000 },
                },
                {
                    name: "Outdoor Dinners",
                    key: "outdoorDinners",
                    budget: { good: 3250, normal: 3750 },
                },
                {
                    name: "Transport Fees",
                    key: "transportFees",
                    budget: { good: 3500, normal: 4000 },
                },
                {
                    name: "Entertainment",
                    key: "entertainment",
                    budget: { good: 3500, normal: 4000 },
                },
                {
                    name: "Education",
                    key: "education",
                    budget: { good: 375, normal: 500 },
                },
                {
                    name: "Shopping",
                    key: "shopping",
                    budget: { good: 5000, normal: 6250 },
                },
                {
                    name: "Medical Fees",
                    key: "medicalFees",
                    budget: { good: 2000, normal: 2500 },
                },
            ];

            let expenses = JSON.parse(localStorage.getItem("expenses")) || [];
            let pieChart;

            function saveExpenses() {
                localStorage.setItem("expenses", JSON.stringify(expenses));
            }

            function addOrUpdateExpense(event) {
                event.preventDefault();
                const category = document.getElementById("category").value;
                const date = document.getElementById("date").value;
                const amount = parseFloat(
                    document.getElementById("amount").value,
                );
                const editIndex = document.getElementById("editIndex").value;

                if (editIndex === "") {
                    expenses.push({ category, date, amount });
                } else {
                    expenses[parseInt(editIndex)] = { category, date, amount };
                    document.getElementById("submitBtn").textContent =
                        "Add Expense";
                }

                saveExpenses();
                updateExpenseList();
                updatePieChart();
                updateBudgetStatus();
                updateWeeklyReminder();
                document.getElementById("amount").value = "";
                document.getElementById("editIndex").value = "";
            }

            function editExpense(index) {
                const expense = expenses[index];
                document.getElementById("category").value = expense.category;
                document.getElementById("date").value = expense.date;
                document.getElementById("amount").value = expense.amount;
                document.getElementById("editIndex").value = index;
                document.getElementById("submitBtn").textContent =
                    "Update Expense";
            }

            function deleteExpense(index) {
                expenses.splice(index, 1);
                saveExpenses();
                updateExpenseList();
                updatePieChart();
                updateBudgetStatus();
                updateWeeklyReminder();
            }

            function updateExpenseList() {
                const expenseList = document.getElementById("expenseList");
                expenseList.innerHTML = "";

                // Group expenses by week
                const groupedExpenses = expenses.reduce((groups, expense) => {
                    const expenseDate = new Date(expense.date);
                    const weekStart = new Date(
                        expenseDate.setDate(
                            expenseDate.getDate() - expenseDate.getDay(),
                        ),
                    );
                    const weekKey = weekStart.toISOString().split("T")[0];
                    if (!groups[weekKey]) {
                        groups[weekKey] = [];
                    }
                    groups[weekKey].push(expense);
                    return groups;
                }, {});

                // Sort weeks in descending order
                const sortedWeeks = Object.keys(groupedExpenses).sort(
                    (a, b) => new Date(b) - new Date(a),
                );

                sortedWeeks.forEach((weekKey) => {
                    const weekBlock = document.createElement("div");
                    weekBlock.className = "week-block";
                    weekBlock.innerHTML = `<h3>Week of ${weekKey}</h3>`;

                    groupedExpenses[weekKey].forEach((expense, index) => {
                        const categoryName = EXPENSE_CATEGORIES.find(
                            (cat) => cat.key === expense.category,
                        ).name;
                        const expenseItem = document.createElement("div");
                        expenseItem.className = "expense-item";
                        expenseItem.innerHTML = `
                            <span>${categoryName} - ${expense.date} - $${expense.amount}</span>
                            <div>
                                <button onclick="editExpense(${expenses.indexOf(expense)})">Edit</button>
                                <button onclick="deleteExpense(${expenses.indexOf(expense)})">Delete</button>
                            </div>
                        `;
                        weekBlock.appendChild(expenseItem);
                    });

                    expenseList.appendChild(weekBlock);
                });
            }

            function updatePieChart() {
                const totals = getWeeklyTotals();
                const totalAmount = Object.values(totals).reduce(
                    (sum, value) => sum + value,
                    0,
                );

                const data = EXPENSE_CATEGORIES.map((category) => ({
                    label: category.name,
                    value: totals[category.key] || 0,
                }));

                if (pieChart) {
                    pieChart.destroy();
                }

                const ctx = document
                    .getElementById("pieChart")
                    .getContext("2d");
                pieChart = new Chart(ctx, {
                    type: "pie",
                    data: {
                        labels: data.map((d) => d.label),
                        datasets: [
                            {
                                data: data.map((d) => d.value),
                                backgroundColor: [
                                    "#FF6384",
                                    "#36A2EB",
                                    "#FFCE56",
                                    "#4BC0C0",
                                    "#9966FF",
                                    "#FF9F40",
                                    "#FF6384",
                                ],
                            },
                        ],
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: "bottom",
                            },
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        const label = context.label || "";
                                        const value = context.parsed || 0;
                                        const percentage = (
                                            (value / totalAmount) *
                                            100
                                        ).toFixed(2);
                                        return `${label}: ${percentage}%`;
                                    },
                                },
                            },
                        },
                    },
                });
            }

            function updateBudgetStatus() {
                const budgetStatus = document.getElementById("budgetStatus");
                budgetStatus.innerHTML = "";

                // Group expenses by week
                const groupedExpenses = expenses.reduce((groups, expense) => {
                    const expenseDate = new Date(expense.date);
                    const weekStart = new Date(
                        expenseDate.setDate(
                            expenseDate.getDate() - expenseDate.getDay(),
                        ),
                    );
                    const weekKey = weekStart.toISOString().split("T")[0];
                    if (!groups[weekKey]) {
                        groups[weekKey] = [];
                    }
                    groups[weekKey].push(expense);
                    return groups;
                }, {});

                // Sort weeks in descending order
                const sortedWeeks = Object.keys(groupedExpenses).sort(
                    (a, b) => new Date(b) - new Date(a),
                );

                // Create a block for total budget status
                const totalBlock = document.createElement("div");
                totalBlock.className = "budget-status-block";
                totalBlock.innerHTML = "<h3>Total Budget Status</h3>";
                budgetStatus.appendChild(totalBlock);

                // Calculate and display weekly budget status
                sortedWeeks.forEach((weekKey) => {
                    const weeklyBlock = document.createElement("div");
                    weeklyBlock.className = "budget-status-block";
                    weeklyBlock.innerHTML = `<h3>Week of ${weekKey}</h3>`;

                    const weeklyTotals = groupedExpenses[weekKey].reduce(
                        (totals, expense) => {
                            totals[expense.category] =
                                (totals[expense.category] || 0) +
                                expense.amount;
                            return totals;
                        },
                        {},
                    );

                    EXPENSE_CATEGORIES.forEach((category) => {
                        const amount = weeklyTotals[category.key] || 0;
                        let status, className;
                        if (amount < category.budget.good) {
                            status = "Good";
                            className = "budget-status-good";
                        } else if (amount < category.budget.normal) {
                            status = "Normal";
                            className = "budget-status-normal";
                        } else {
                            status = "Over Budget";
                            className = "budget-status-over";
                        }
                        weeklyBlock.innerHTML += `<div class="budget-status-item ${className}">${category.name}: ${status} - $${amount.toFixed(2)}</div>`;
                    });

                    budgetStatus.appendChild(weeklyBlock);
                });

                // Calculate and display total budget status
                const totalTotals = expenses.reduce((totals, expense) => {
                    totals[expense.category] =
                        (totals[expense.category] || 0) + expense.amount;
                    return totals;
                }, {});

                EXPENSE_CATEGORIES.forEach((category) => {
                    const amount = totalTotals[category.key] || 0;
                    let status, className;
                    if (amount < category.budget.good) {
                        status = "Good";
                        className = "budget-status-good";
                    } else if (amount < category.budget.normal) {
                        status = "Normal";
                        className = "budget-status-normal";
                    } else {
                        status = "Over Budget";
                        className = "budget-status-over";
                    }
                    totalBlock.innerHTML += `<div class="budget-status-item ${className}">${category.name}: ${status} - $${amount.toFixed(2)}</div>`;
                });
            }

            function getWeeklyTotals() {
                const now = new Date();
                const oneWeekAgo = new Date(
                    now.getFullYear(),
                    now.getMonth(),
                    now.getDate() - 7,
                );

                return expenses
                    .filter((expense) => new Date(expense.date) >= oneWeekAgo)
                    .reduce((acc, expense) => {
                        acc[expense.category] =
                            (acc[expense.category] || 0) + expense.amount;
                        return acc;
                    }, {});
            }

            function updateWeeklyReminder() {
                const weeklyReminder =
                    document.getElementById("weeklyReminder");
                const totals = getWeeklyTotals();

                const totalSpent = Object.values(totals).reduce(
                    (sum, value) => sum + value,
                    0,
                );
                const totalBudget = EXPENSE_CATEGORIES.reduce(
                    (sum, category) => sum + category.budget.normal,
                    0,
                );

                let message;
                if (totalSpent < totalBudget * 0.8) {
                    message = `Great job! You're saving money this week. Total spent: $${totalSpent.toFixed(2)}`;
                } else if (totalSpent <= totalBudget) {
                    message = `You're on track with your budget this week. Total spent: $${totalSpent.toFixed(2)}`;
                } else {
                    message = `Warning: You're over budget this week. Total spent: $${totalSpent.toFixed(2)}`;
                }

                weeklyReminder.innerHTML = message;
            }

            function clearAllData() {
                if (
                    confirm(
                        "Are you sure you want to clear all expense data? This action cannot be undone.",
                    )
                ) {
                    expenses = [];
                    saveExpenses();
                    updateExpenseList();
                    updatePieChart();
                    updateBudgetStatus();
                    updateWeeklyReminder();
                }
            }

            document
                .getElementById("expenseForm")
                .addEventListener("submit", addOrUpdateExpense);
            document
                .getElementById("clearAllData")
                .addEventListener("click", clearAllData);

            // Category icon functionality
            const categoryIcons = document.querySelectorAll(".category-icon");
            const categorySelect = document.getElementById("category");

            categoryIcons.forEach((icon) => {
                icon.addEventListener("click", () => {
                    categorySelect.value = icon.dataset.category;
                    categoryIcons.forEach((i) => i.classList.remove("active"));
                    icon.classList.add("active");
                });
            });

            // Initialize Flatpickr
            flatpickr("#date", {
                dateFormat: "Y-m-d",
                defaultDate: "today",
                inline: true,
            });

            // Initial render
            updateExpenseList();
            updatePieChart();
            updateBudgetStatus();
            updateWeeklyReminder();
        </script>
    </body>
</html>
