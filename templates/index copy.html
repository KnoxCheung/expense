<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Expense Manager</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
        }
        .container {
            display: flex;
            width: 100%;
        }
        .left-panel, .right-panel {
            padding: 20px;
            flex: 1;
        }
        .left-panel {
            background-color: #f0f0f0;
        }
        .right-panel {
            background-color: #e0e0e0;
        }
        .category-icons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        .category-icons button {
            padding: 10px;
            border: none;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
        }
        #expenseList, #recurringExpenseList {
            margin-top: 20px;
        }
        #pieChartContainer {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="left-panel">
            <h2>Add/Edit Expense</h2>
            <div class="category-icons">
                <button onclick="selectCategory('Food')">Food</button>
                <button onclick="selectCategory('Transport')">Transport</button>
                <button onclick="selectCategory('Entertainment')">Entertainment</button>
                <button onclick="selectCategory('Education')">Education</button>
                <button onclick="selectCategory('Shopping')">Shopping</button>
                <button onclick="selectCategory('Medical')">Medical</button>
            </div>
            <input type="text" id="category" placeholder="Category">
            <input type="number" id="amount" placeholder="Amount">
            <button onclick="addExpense()">Add Expense</button>

            <h2>Add Recurring Expense</h2>
            <input type="text" id="recurringCategory" placeholder="Category">
            <input type="number" id="recurringAmount" placeholder="Amount">
            <select id="recurringFrequency">
                <option value="daily">Daily</option>
                <option value="weekly">Weekly</option>
                <option value="monthly">Monthly</option>
                <option value="yearly">Yearly</option>
            </select>
            <button onclick="addRecurringExpense()">Add Recurring Expense</button>

            <h2>Expense List</h2>
            <div id="expenseList"></div>

            <h2>Recurring Expense List</h2>
            <div id="recurringExpenseList"></div>

            <button onclick="clearAllData()">Clear All Data</button>
        </div>
        <div class="right-panel">
            <h2>Expense Summary</h2>
            <div id="pieChartContainer">
                <canvas id="pieChart"></canvas>
            </div>

            <h2>Budget Status</h2>
            <div id="budgetStatus"></div>

            <h2>Weekly Reminder</h2>
            <input type="email" id="emailInput" placeholder="Enter your email">
            <button onclick="sendWeeklyReminder()">Send Reminder</button>
        </div>
    </div>

    <script>
        let expenses = [];
        let recurringExpenses = [];
        let pieChart;

        function selectCategory(category) {
            document.getElementById('category').value = category;
        }

        function addExpense() {
            const category = document.getElementById('category').value;
            const amount = parseFloat(document.getElementById('amount').value);

            if (category && amount) {
                fetch('/api/add_expense', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ category, amount })
                }).then(response => response.json())
                  .then(data => {
                      if (data.status === 'success') {
                          fetchExpenses();
                          fetchBudgetStatus();
                      }
                  })
                  .catch(error => console.error('Error:', error));
            }
        }

        function addRecurringExpense() {
            const category = document.getElementById('recurringCategory').value;
            const amount = parseFloat(document.getElementById('recurringAmount').value);
            const frequency = document.getElementById('recurringFrequency').value;

            if (category && amount && frequency) {
                fetch('/api/add_recurring_expense', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ category, amount, frequency })
                }).then(response => response.json())
                  .then(data => {
                      if (data.status === 'success') {
                          fetchRecurringExpenses();
                      }
                  })
                  .catch(error => console.error('Error:', error));
            }
        }

        function updateExpenseList() {
            const list = document.getElementById('expenseList');
            list.innerHTML = '';
            expenses.forEach((expense, index) => {
                list.innerHTML += `<p>${expense.category}: $${expense.amount} on ${expense.date} <button onclick="removeExpense(${index})">Remove</button></p>`;
            });
        }

        function updateRecurringExpenseList() {
            const list = document.getElementById('recurringExpenseList');
            list.innerHTML = '';
            recurringExpenses.forEach((expense, index) => {
                list.innerHTML += `<p>${expense.category}: $${expense.amount} (${expense.frequency}) <button onclick="removeRecurringExpense(${index})">Remove</button></p>`;
            });
        }

        function removeExpense(index) {
            // In a full implementation, you would send a request to the backend to remove the expense
            expenses.splice(index, 1);
            updateExpenseList();
            updatePieChart();
            fetchBudgetStatus();
        }

        function removeRecurringExpense(index) {
            // In a full implementation, you would send a request to the backend to remove the recurring expense
            recurringExpenses.splice(index, 1);
            updateRecurringExpenseList();
        }

        function updatePieChart() {
            const ctx = document.getElementById('pieChart').getContext('2d');
            const data = {};
            expenses.forEach(expense => {
                if (data[expense.category]) {
                    data[expense.category] += expense.amount;
                } else {
                    data[expense.category] = expense.amount;
                }
            });

            if (pieChart) {
                pieChart.destroy();
            }

            pieChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(data),
                    datasets: [{
                        data: Object.values(data),
                        backgroundColor: [
                            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'
                        ]
                    }]
                }
            });
        }

        function clearAllData() {
            fetch('/api/clear_data', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        fetchExpenses();
                        fetchRecurringExpenses();
                        fetchBudgetStatus();
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        function sendWeeklyReminder() {
            const email = document.getElementById('emailInput').value;
            if (email) {
                fetch('/api/send_reminder', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                }).then(response => response.json())
                  .then(data => {
                      if (data.status === 'success') {
                          alert('Reminder sent successfully!');
                      } else {
                          alert('Failed to send reminder. Please try again.');
                      }
                  })
                  .catch(error => console.error('Error:', error));
            } else {
                alert('Please enter an email address.');
            }
        }

        function fetchExpenses() {
            fetch('/api/get_expenses')
                .then(response => response.json())
                .then(data => {
                    expenses = data.expenses;
                    updateExpenseList();
                    updatePieChart();
                });
        }

        function fetchRecurringExpenses() {
            fetch('/api/get_recurring_expenses')
                .then(response => response.json())
                .then(data => {
                    recurringExpenses = data.recurring_expenses;
                    updateRecurringExpenseList();
                });
        }

        function fetchBudgetStatus() {
            fetch('/api/get_budget_status')
                .then(response => response.json())
                .then(data => {
                    const status = document.getElementById('budgetStatus');
                    status.innerHTML = `
                        <p>Budget Limit: $${data.amount}</p>
                        <p>Total Spent: $${data.spent.toFixed(2)}</p>
                        <p>Remaining: $${data.remaining.toFixed(2)}</p>
                    `;
                });
        }

        // Initialize the UI
        document.addEventListener('DOMContentLoaded', function() {
            fetchExpenses();
            fetchRecurringExpenses();
            fetchBudgetStatus();
        });
    </script>
</body>
</html>